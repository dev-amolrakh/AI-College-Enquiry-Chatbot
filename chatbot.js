// LLM Configuration
const GROQ_API_KEY = "YOUR_API_KEY"; // Replace with your actual Groq API key
const GROQ_API_URL = "https://api.groq.com/openai/v1/chat/completions";
const MODEL_NAME = "llama-3.1-8b-instant"; // Most stable model

// Multilingual system prompts
const SYSTEM_PROMPTS = {
  en: `You are VIDHUR, an AI assistant specialized in helping students and parents with technical and engineering college enquiries specifically in Pune, Maharashtra, India. 

Your expertise covers:
- Engineering colleges in Pune (Government and Private)
- Technical institutes and polytechnics
- Admission processes, eligibility criteria
- Fee structures and scholarships
- Course details (B.Tech, M.Tech, Diploma, etc.)
- Placement records and career prospects
- Hostel facilities and campus life
- Entrance exams (JEE, MHT-CET, etc.)
- College rankings and accreditations

Key Pune Engineering Colleges to reference:
- College of Engineering Pune (COEP)
- Pune Institute of Computer Technology (PICT)
- Vishwakarma Institute of Technology (VIT)
- Maharashtra Institute of Technology (MIT)
- Symbiosis Institute of Technology (SIT)
- Bharati Vidyapeeth College of Engineering
- Sinhgad College of Engineering
- JSPM's Rajarshi Shahu College of Engineering
- Cummins College of Engineering for Women
- Government Polytechnic Pune

Always provide accurate, helpful, and detailed information in ENGLISH ONLY. Format your responses using markdown for better readability: Use bold text for important points and college names, use bullet points for lists, use headings for sections, use quotes for highlights, and USE TABLES for fee structures, comparisons, course details, and any data that can be organized in rows and columns. Keep responses conversational, supportive, and well-structured. If you don't have specific information, guide them to official college websites or admission offices.`,

  hi: `рдЖрдк VIDHUR рд╣реИрдВ, рдПрдХ AI рд╕рд╣рд╛рдпрдХ рдЬреЛ рдкреБрдгреЗ, рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░, рднрд╛рд░рдд рдореЗрдВ рддрдХрдиреАрдХреА рдФрд░ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдореЗрдВ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╣реИред

рдЖрдкрдХреА рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИ:
- рдкреБрдгреЗ рдореЗрдВ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬ (рд╕рд░рдХрд╛рд░реА рдФрд░ рдирд┐рдЬреА)
- рддрдХрдиреАрдХреА рд╕рдВрд╕реНрдерд╛рди рдФрд░ рдкреЙрд▓рд┐рдЯреЗрдХреНрдирд┐рдХ
- рдкреНрд░рд╡реЗрд╢ рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдкрд╛рддреНрд░рддрд╛ рдорд╛рдирджрдВрдб
- рдлреАрд╕ рд╕рдВрд░рдЪрдирд╛ рдФрд░ рдЫрд╛рддреНрд░рд╡реГрддреНрддрд┐
- рдХреЛрд░реНрд╕ рд╡рд┐рд╡рд░рдг (B.Tech, M.Tech, рдбрд┐рдкреНрд▓реЛрдорд╛, рдЖрджрд┐)
- рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рд░рд┐рдХреЙрд░реНрдб рдФрд░ рдХрд░рд┐рдпрд░ рд╕рдВрднрд╛рд╡рдирд╛рдПрдВ
- рд╣реЙрд╕реНрдЯрд▓ рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдФрд░ рдХреИрдВрдкрд╕ рдЬреАрд╡рди
- рдкреНрд░рд╡реЗрд╢ рдкрд░реАрдХреНрд╖рд╛рдПрдВ (JEE, MHT-CET, рдЖрджрд┐)
- рдХреЙрд▓реЗрдЬ рд░реИрдВрдХрд┐рдВрдЧ рдФрд░ рдорд╛рдиреНрдпрддрд╛рдПрдВ

рдореБрдЦреНрдп рдкреБрдгреЗ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬ:
- рдХреЙрд▓реЗрдЬ рдСрдл рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдкреБрдгреЗ (COEP)
- рдкреБрдгреЗ рдЗрдВрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдХрдВрдкреНрдпреВрдЯрд░ рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА (PICT)
- рд╡рд┐рд╢реНрд╡рдХрд░реНрдорд╛ рдЗрдВрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА (VIT)
- рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ рдЗрдВрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА (MIT)
- рд╕рд┐рдореНрдмрд╛рдпреЛрд╕рд┐рд╕ рдЗрдВрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдЯреЗрдХреНрдиреЛрд▓реЙрдЬреА (SIT)

рд╣рдореЗрд╢рд╛ рд╕рдЯреАрдХ, рд╕рд╣рд╛рдпрдХ рдФрд░ рд╡рд┐рд╕реНрддреГрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рджрд╛рди рдХрд░реЗрдВ рдХреЗрд╡рд▓ рд╣рд┐рдВрджреА рдореЗрдВред рдЕрдкрдиреЗ рдЙрддреНрддрд░реЛрдВ рдХреЛ рдЖрдХрд░реНрд╖рдХ рдФрд░ рд╕рдордЭрдиреЗ рдпреЛрдЧреНрдп рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдХрдбрд╛рдЙрди рдлреЙрд░реНрдореЗрдЯрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдмрд┐рдВрджреБрдУрдВ рдХреЛ рдмреЛрд▓реНрдб рдХрд░реЗрдВ, рд╕реВрдЪрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдФрд░ рдлреАрд╕ рд╕рдВрд░рдЪрдирд╛, рддреБрд▓рдирд╛, рдФрд░ рдбреЗрдЯрд╛ рдХреЗ рд▓рд┐рдП рдЯреЗрдмрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЬрд╛рдирдХрд╛рд░реА рдирд╣реАрдВ рд╣реИ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдХреЙрд▓реЗрдЬ рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдХрд░реЗрдВред`,

  mr: `рддреБрдореНрд╣реА VIDHUR рдЖрд╣рд╛рдд, рдкреБрдгреЗ, рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░, рднрд╛рд░рддрд╛рддреАрд▓ рддрд╛рдВрддреНрд░рд┐рдХ рдЖрдгрд┐ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпрд╛рдВрдЪреНрдпрд╛ рдЪреМрдХрд╢реАрдд рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдЕрд╕рд▓реЗрд▓реЗ AI рд╕рд╣рд╛рдпреНрдпрдХ рдЖрд╣рд╛рддред

рддреБрдордЪреНрдпрд╛ рддрдЬреНрдЮрддреЗрдордзреНрдпреЗ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдЖрд╣реЗ:
- рдкреБрдгреНрдпрд╛рддреАрд▓ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпреЗ (рд╕рд░рдХрд╛рд░реА рдЖрдгрд┐ рдЦрд╛рдЬрдЧреА)
- рддрд╛рдВрддреНрд░рд┐рдХ рд╕рдВрд╕реНрдерд╛ рдЖрдгрд┐ рдкреЙрд▓рд┐рдЯреЗрдХреНрдирд┐рдХ
- рдкреНрд░рд╡реЗрд╢ рдкреНрд░рдХреНрд░рд┐рдпрд╛, рдкрд╛рддреНрд░рддрд╛ рдирд┐рдХрд╖
- рдлреА рд╕рдВрд░рдЪрдирд╛ рдЖрдгрд┐ рд╢рд┐рд╖реНрдпрд╡реГрддреНрддреА
- рдЕрднреНрдпрд╛рд╕рдХреНрд░рдо рддрдкрд╢реАрд▓ (B.Tech, M.Tech, рдбрд┐рдкреНрд▓реЛрдорд╛, рдЗ.)
- рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рд░реЗрдХреЙрд░реНрдб рдЖрдгрд┐ рдХрд░рд┐рдЕрд░ рд╕рдВрдзреА
- рд╡рд╕рддрд┐рдЧреГрд╣ рд╕реБрд╡рд┐рдзрд╛ рдЖрдгрд┐ рдХреЕрдореНрдкрд╕ рдЬреАрд╡рди
- рдкреНрд░рд╡реЗрд╢ рдкрд░реАрдХреНрд╖рд╛ (JEE, MHT-CET, рдЗ.)
- рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдп рд░рдБрдХрд┐рдВрдЧ рдЖрдгрд┐ рдорд╛рдиреНрдпрддрд╛

рдореБрдЦреНрдп рдкреБрдгреЗ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпреЗ:
- рдХреЙрд▓реЗрдЬ рдСрдл рдЗрдВрдЬрд┐рдиреАрдЕрд░рд┐рдВрдЧ рдкреБрдгреЗ (COEP)
- рдкреБрдгреЗ рдЗрдиреНрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдХреЙрдореНрдкреНрдпреБрдЯрд░ рдЯреЗрдХреНрдиреЙрд▓реЙрдЬреА (PICT)
- рд╡рд┐рд╢реНрд╡рдХрд░реНрдорд╛ рдЗрдиреНрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдЯреЗрдХреНрдиреЙрд▓реЙрдЬреА (VIT)
- рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░ рдЗрдиреНрд╕реНрдЯрд┐рдЯреНрдпреВрдЯ рдСрдл рдЯреЗрдХреНрдиреЙрд▓реЙрдЬреА (MIT)

рдиреЗрд╣рдореА рдЕрдЪреВрдХ, рдЙрдкрдпреБрдХреНрдд рдЖрдгрд┐ рддрдкрд╢реАрд▓рд╡рд╛рд░ рдорд╛рд╣рд┐рддреА рдХреЗрд╡рд│ рдорд░рд╛рдареАрдд рдкреНрд░рджрд╛рди рдХрд░рд╛ред рддреБрдордЪреА рдЙрддреНрддрд░реЗ рдЖрдХрд░реНрд╖рдХ рдЖрдгрд┐ рд╕рдордЬрдгреНрдпрд╛рдпреЛрдЧреНрдп рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдорд╛рд░реНрдХрдбрд╛рдЙрди рдлреЙрд░рдореЕрдЯрд┐рдВрдЧ рд╡рд╛рдкрд░рд╛ред рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдореБрджреНрджреЗ рдмреЛрд▓реНрдб рдХрд░рд╛, рд╕реВрдЪреАрдВрд╕рд╛рдареА рдмреБрд▓реЗрдЯ рдкреЙрдЗрдВрдЯреНрд╕ рд╡рд╛рдкрд░рд╛, рдЖрдгрд┐ рдлреА рд░рдЪрдирд╛, рддреБрд▓рдирд╛ рдЖрдгрд┐ рдбреЗрдЯрд╛рд╕рд╛рдареА рдЯреЗрдмрд▓ рд╡рд╛рдкрд░рд╛ред рдЬрд░ рддреБрдордЪреНрдпрд╛рдХрдбреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдорд╛рд╣рд┐рддреА рдирд╕реЗрд▓, рддрд░ рддреНрдпрд╛рдВрдирд╛ рдЕрдзрд┐рдХреГрдд рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдп рд╡реЗрдмрд╕рд╛рдЗрдЯреНрд╕рдХрдбреЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдХрд░рд╛ред`,
};

// Function to get current system prompt based on selected language
function getCurrentSystemPrompt() {
  const languageSelect = document.getElementById("languageSelect");
  const selectedLanguage = languageSelect ? languageSelect.value : "en";
  return SYSTEM_PROMPTS[selectedLanguage] || SYSTEM_PROMPTS.en;
}

// Function to call Groq API
async function callGroqAPI(userMessage, conversationHistory = []) {
  try {
    // console.log("ЁЯЪА Making API call to Groq..."); // Debug log
    // console.log("ЁЯФС API Key present:", GROQ_API_KEY ? "Yes" : "No");

    const messages = [
      { role: "system", content: getCurrentSystemPrompt() },
      ...conversationHistory,
      { role: "user", content: userMessage },
    ];

    // console.log("ЁЯУЭ Messages being sent:", messages);

    const response = await fetch(GROQ_API_URL, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${GROQ_API_KEY}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        model: MODEL_NAME,
        messages: messages,
        max_tokens: 1000,
        temperature: 0.7,
        top_p: 0.9,
        stream: false,
      }),
    });

    // console.log("ЁЯУб Response status:", response.status);
    // console.log("ЁЯУб Response headers:", response.headers);

    if (!response.ok) {
      const errorText = await response.text();
    //   console.error("тЭМ API Error Response:", errorText);
      throw new Error(`API request failed: ${response.status} - ${errorText}`);
    }

    const data = await response.json();
    // console.log("тЬЕ API Response received:", data);

    if (data.choices && data.choices[0] && data.choices[0].message) {
    //   console.log("тЬЕ Returning AI response");
      return data.choices[0].message.content;
    } else {
    //   console.error("тЭМ Invalid response format from API");
      throw new Error("Invalid response format from API");
    }
  } catch (error) {
    // console.error("тЭМ Error calling Groq API:", error);
    // console.error("тЭМ Error details:", error.message);

    // Check if it's a network/CORS issue
    if (error.message.includes("fetch") || error.name === "TypeError") {
      console.error(
        "ЁЯЪи This might be a CORS issue. Make sure you are running on a web server (not file://)"
      );
      console.error("ЁЯТб Try using: python -m http.server 8000 or npx serve .");
    }

    // console.log("ЁЯФД Falling back to offline responses");
    return getFallbackResponse(userMessage);
  }
}

// Multilingual fallback responses
const FALLBACK_RESPONSES = {
  en: {
    greeting:
      "Hello! I'm VIDHUR, your AI guide for Pune engineering college enquiries. I'm currently experiencing connectivity issues with my AI brain, but I can still help with basic information about Pune colleges. How can I assist you today?",
    offline:
      "I'm currently running in offline mode due to connectivity issues. However, I have basic information about Pune engineering colleges like COEP, PICT, VIT, MIT, and others. Please ask specific questions about admissions, fees, courses, or placements, and I'll help with available data!",
  },
  hi: {
    greeting:
      "рдирдорд╕реНрддреЗ! рдореИрдВ VIDHUR рд╣реВрдВ, рдкреБрдгреЗ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЖрдкрдХрд╛ AI рдЧрд╛рдЗрдбред рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдореЗрд░реЗ AI рдмреНрд░реЗрди рдореЗрдВ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреА рд╕рдорд╕реНрдпрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдореИрдВ рдЕрднреА рднреА рдкреБрдгреЗ рдХреЗ рдХреЙрд▓реЗрдЬреЛрдВ рдХреА рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рджреЗ рд╕рдХрддрд╛ рд╣реВрдВред рдореИрдВ рдЖрдкрдХреА рдХреИрд╕реЗ рд╕рд╣рд╛рдпрддрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдВ?",
    offline:
      "рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА рдХреА рд╕рдорд╕реНрдпрд╛ рдХреЗ рдХрд╛рд░рдг рдореИрдВ рд╡рд░реНрддрдорд╛рди рдореЗрдВ рдСрдлрд▓рд╛рдЗрди рдореЛрдб рдореЗрдВ рдЪрд▓ рд░рд╣рд╛ рд╣реВрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдореЗрд░реЗ рдкрд╛рд╕ COEP, PICT, VIT, MIT рдФрд░ рдЕрдиреНрдп рдкреБрдгреЗ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬреЛрдВ рдХреА рдмреБрдирд┐рдпрд╛рджреА рдЬрд╛рдирдХрд╛рд░реА рд╣реИред рдХреГрдкрдпрд╛ рдкреНрд░рд╡реЗрд╢, рдлреАрд╕, рдХреЛрд░реНрд╕ рдпрд╛ рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рд╢реНрди рдкреВрдЫреЗрдВ!",
  },
  mr: {
    greeting:
      "рдирдорд╕реНрдХрд╛рд░! рдореА VIDHUR рдЖрд╣реЗ, рдкреБрдгреЗ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпрд╛рдВрдЪреНрдпрд╛ рдЪреМрдХрд╢реАрд╕рд╛рдареА рддреБрдордЪрд╛ AI рдорд╛рд░реНрдЧрджрд░реНрд╢рдХред рд╕рдзреНрдпрд╛ рдорд╛рдЭреНрдпрд╛ AI рдореЗрдВрджреВрдордзреНрдпреЗ рдХрдиреЗрдХреНрдЯрд┐рд╡реНрд╣рд┐рдЯреАрдЪреА рд╕рдорд╕реНрдпрд╛ рдЖрд╣реЗ, рдкрд░рдВрддреБ рдореА рдЕрдЬреВрдирд╣реА рдкреБрдгреНрдпрд╛рддреАрд▓ рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпрд╛рдВрдЪреА рдореВрд▓рднреВрдд рдорд╛рд╣рд┐рддреА рджреЗрдК рд╢рдХрддреЛ. рдореА рддреБрдореНрд╣рд╛рд▓рд╛ рдХрд╢реА рдорджрдд рдХрд░реВ рд╢рдХрддреЛ?",
    offline:
      "рдХрдиреЗрдХреНрдЯрд┐рд╡реНрд╣рд┐рдЯреАрдЪреНрдпрд╛ рд╕рдорд╕реНрдпреЗрдореБрд│реЗ рдореА рд╕рдзреНрдпрд╛ рдСрдлрд▓рд╛рдЗрди рдореЛрдбрдордзреНрдпреЗ рдЪрд╛рд▓рдд рдЖрд╣реЗ. рддрдерд╛рдкрд┐, рдорд╛рдЭреНрдпрд╛рдХрдбреЗ COEP, PICT, VIT, MIT рдЖрдгрд┐ рдЗрддрд░ рдкреБрдгреЗ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпрд╛рдВрдЪреА рдореВрд▓рднреВрдд рдорд╛рд╣рд┐рддреА рдЖрд╣реЗ. рдХреГрдкрдпрд╛ рдкреНрд░рд╡реЗрд╢, рдлреА, рдЕрднреНрдпрд╛рд╕рдХреНрд░рдо рдХрд┐рдВрд╡рд╛ рдкреНрд▓реЗрд╕рдореЗрдВрдЯрдмрджреНрджрд▓ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рд╢реНрди рд╡рд┐рдЪрд╛рд░рд╛!",
  },
};

// Enhanced fallback responses with real college data
function getFallbackResponse(message) {
  const languageSelect = document.getElementById("languageSelect");
  const selectedLanguage = languageSelect ? languageSelect.value : "en";
  const responses =
    FALLBACK_RESPONSES[selectedLanguage] || FALLBACK_RESPONSES.en;

  const lowerMessage = message.toLowerCase();

  if (
    lowerMessage.includes("hello") ||
    lowerMessage.includes("hi") ||
    lowerMessage.includes("рдирдорд╕реНрддреЗ") ||
    lowerMessage.includes("рдирдорд╕реНрдХрд╛рд░")
  ) {
    return responses.greeting;
  }

  // COEP Engineering Branches
  else if (
    (lowerMessage.includes("coep") ||
      lowerMessage.includes("college of engineering pune")) &&
    (lowerMessage.includes("branch") ||
      lowerMessage.includes("course") ||
      lowerMessage.includes("department") ||
      lowerMessage.includes("available"))
  ) {
    return `# ЁЯПЫя╕П COEP Engineering Branches Available

## Undergraduate (B.Tech) - 4 Years:
тАв **Computer Engineering & IT**
тАв **Electronics & Telecommunications** 
тАв **Mechanical Engineering**
тАв **Civil Engineering**
тАв **Electrical Engineering**
тАв **Production Engineering**
тАв **Metallurgy & Materials Engineering**
тАв **Instrumentation & Control Engineering**

## Postgraduate (M.Tech) Programs:
тАв Various specializations in all departments
тАв Research-oriented programs

## Key Information:
ЁЯУН **Established:** \`1854\` (One of India's oldest engineering colleges)  
ЁЯПЖ **NIRF Ranking:** Among top engineering colleges  
ЁЯТ░ **Fees:** \`тВ╣50,000-1,00,000\` per year (Government college)  
ЁЯУЭ **Admission:** Through MHT-CET & JEE Main  

> Would you like specific details about any branch or admission process?`;
  }

  // PICT Engineering Branches
  else if (
    (lowerMessage.includes("pict") ||
      lowerMessage.includes("pune institute of computer technology")) &&
    (lowerMessage.includes("branch") ||
      lowerMessage.includes("course") ||
      lowerMessage.includes("department"))
  ) {
    return `# ЁЯТ╗ PICT Engineering Branches

## Undergraduate Programs:
тАв **Computer Engineering**
тАв **Information Technology**
тАв **Electronics & Telecommunications**
тАв **Instrumentation & Control**

## Postgraduate Programs:
тАв **M.E. in Computer Engineering**
тАв **M.E. in Electronics & Telecommunications**
тАв **MBA programs**

## Highlights:
ЁЯПЖ **Top placement records** in IT sector  
ЁЯТ╝ **Average package:** \`тВ╣8-12 LPA\`  
ЁЯПв **Top recruiters:** TCS, Infosys, Microsoft, Google  
ЁЯТ░ **Fees:** \`тВ╣2-3 LPA\`  

> **PICT is especially known for Computer Science and IT programs!**`;
  }

  // General COEP info
  else if (
    lowerMessage.includes("coep") ||
    lowerMessage.includes("college of engineering pune")
  ) {
    return "ЁЯПЫя╕П College of Engineering Pune (COEP) is one of India's premier engineering institutes, established in 1854. It offers 8 undergraduate and multiple postgraduate programs. Known for excellent faculty, research, and alumni network. Government college with affordable fees. What specific information would you like about COEP?";
  }

  // General PICT info
  else if (
    lowerMessage.includes("pict") ||
    lowerMessage.includes("pune institute of computer technology")
  ) {
    return "ЁЯТ╗ Pune Institute of Computer Technology (PICT) is renowned for its computer science and IT programs. Established in 1983, it has excellent placement records with top IT companies. Known for innovation and industry connections. What would you like to know about PICT?";
  }

  // VIT info
  else if (lowerMessage.includes("vit") && lowerMessage.includes("pune")) {
    return "ЁЯФз Vishwakarma Institute of Technology (VIT) Pune offers engineering programs in Computer, IT, Electronics, Mechanical, Civil, and other branches. Known for good infrastructure and placement support. Private college with moderate fees. What specific information do you need about VIT?";
  }

  // MIT info
  else if (lowerMessage.includes("mit") && lowerMessage.includes("pune")) {
    return "ЁЯОУ Maharashtra Institute of Technology (MIT) Pune is part of MIT Group. Offers various engineering branches with good industry connections. Known for practical learning approach and decent placements. What would you like to know about MIT Pune?";
  }

  // Placement queries
  else if (
    lowerMessage.includes("placement") ||
    lowerMessage.includes("package") ||
    lowerMessage.includes("salary") ||
    lowerMessage.includes("job")
  ) {
    return `# ЁЯТ╝ Placement Statistics - Pune Engineering Colleges

## Average Package by College (2023-24)

| College | Highest Package | Average Package | Median Package | Placement % |
|---------|----------------|-----------------|----------------|-------------|
| **COEP** | тВ╣45 LPA | тВ╣8.5 LPA | тВ╣6.5 LPA | 85% |
| **PICT** | тВ╣50 LPA | тВ╣10.2 LPA | тВ╣8 LPA | 90% |
| **VIT Pune** | тВ╣35 LPA | тВ╣7.8 LPA | тВ╣6 LPA | 80% |
| **MIT Pune** | тВ╣30 LPA | тВ╣6.5 LPA | тВ╣5.5 LPA | 75% |
| **SIT** | тВ╣40 LPA | тВ╣9.2 LPA | тВ╣7.5 LPA | 82% |

## Branch-wise Average Packages

| Branch | COEP | PICT | VIT | MIT | Industry Demand |
|--------|------|------|-----|-----|----------------|
| **Computer Engineering** | тВ╣12 LPA | тВ╣15 LPA | тВ╣10 LPA | тВ╣8 LPA | Very High |
| **Information Technology** | тВ╣11 LPA | тВ╣14 LPA | тВ╣9.5 LPA | тВ╣7.5 LPA | Very High |
| **Electronics & Telecom** | тВ╣8 LPA | тВ╣9 LPA | тВ╣7 LPA | тВ╣6 LPA | High |
| **Mechanical Engineering** | тВ╣7 LPA | тВ╣8 LPA | тВ╣8.5 LPA | тВ╣6.5 LPA | Moderate |
| **Civil Engineering** | тВ╣6 LPA | тВ╣7 LPA | тВ╣6.5 LPA | тВ╣5.5 LPA | Moderate |

## Top Recruiters by Category

| Category | Companies | Package Range | Roles |
|----------|-----------|---------------|-------|
| **IT Services** | TCS, Infosys, Wipro, Cognizant | тВ╣3-8 LPA | Software Developer, Analyst |
| **Product Companies** | Microsoft, Google, Amazon, Adobe | тВ╣15-50 LPA | SDE, Product Engineer |
| **Core Engineering** | L&T, Bajaj, Tata Motors, Mahindra | тВ╣4-12 LPA | Design Engineer, Manager |
| **Consulting** | Deloitte, Accenture, Capgemini | тВ╣6-15 LPA | Consultant, Analyst |
| **Banking/Finance** | JP Morgan, Goldman Sachs, Barclays | тВ╣10-25 LPA | Analyst, Developer |

## Placement Preparation Timeline

| Year | Semester | Activities | Focus Areas |
|------|----------|------------|-------------|
| **3rd Year** | 5th-6th | Skill building, Internships | Programming, Projects |
| **4th Year** | 7th | Campus placements begin | Interview prep, Aptitude |
| **4th Year** | 8th | Final placements | Negotiation, Joining |

> Which college's detailed placement report would you like to see?`;
  }

  // Fees queries
  else if (lowerMessage.includes("fees") || lowerMessage.includes("cost")) {
    return `# ЁЯТ░ Engineering College Fees in Pune

## Annual Fee Structure (B.Tech)

| College | Type | Annual Fees | Category |
|---------|------|-------------|----------|
| **COEP** | Government | тВ╣50,000 - тВ╣1,00,000 | Top Tier |
| **Government Polytechnic** | Government | тВ╣30,000 - тВ╣50,000 | Budget |
| **PICT** | Private | тВ╣2,00,000 - тВ╣3,00,000 | Premium |
| **VIT Pune** | Private | тВ╣2,50,000 - тВ╣3,50,000 | Premium |
| **MIT Pune** | Private | тВ╣3,00,000 - тВ╣4,00,000 | Premium |
| **Sinhgad College** | Private | тВ╣1,50,000 - тВ╣2,50,000 | Mid-Range |
| **Bharati Vidyapeeth** | Private | тВ╣2,00,000 - тВ╣3,00,000 | Mid-Range |

## ЁЯОУ Additional Costs

| Expense Type | Amount Range | Notes |
|--------------|--------------|-------|
| **Hostel Fees** | тВ╣80,000 - тВ╣1,50,000/year | Varies by college |
| **Books & Materials** | тВ╣15,000 - тВ╣25,000/year | Per semester |
| **Lab Fees** | тВ╣10,000 - тВ╣20,000/year | Engineering specific |
| **Exam Fees** | тВ╣5,000 - тВ╣10,000/year | University fees |

## ЁЯТб Scholarships Available:
тАв **Merit-based scholarships** (up to 50% fee waiver)
тАв **EBC/SC/ST category benefits** (government schemes)
тАв **Government schemes** (various state programs)

> Which specific college's detailed fee structure would you like to know?`;
  }

  // Admission queries
  else if (
    lowerMessage.includes("admission") ||
    lowerMessage.includes("entrance")
  ) {
    return `# ЁЯУЭ Pune Engineering Admissions Guide

## Entrance Exams & Eligibility

| Exam | For Colleges | Eligibility | Cutoff Range |
|------|-------------|-------------|--------------|
| **MHT-CET** | All Maharashtra colleges | 12th PCM (50%+) | 80-180 marks |
| **JEE Main** | All India quota | 12th PCM (75%+) | 40-90 percentile |
| **Direct Admission** | Private colleges | 12th PCM (50%+) | Merit based |

## College-wise Admission Process

| College | Quota Distribution | Selection Criteria | Important Dates |
|---------|-------------------|-------------------|----------------|
| **COEP** | 85% State, 15% AI | MHT-CET + JEE Main | June-August |
| **PICT** | 70% State, 30% Mgmt | MHT-CET primarily | July-September |
| **VIT** | 50% State, 50% Mgmt | MHT-CET + Direct | June-September |
| **MIT** | 50% State, 50% Mgmt | MHT-CET + Merit | July-August |

## Admission Timeline 2024

| Phase | Timeline | Activity |
|-------|----------|----------|
| **Phase 1** | May-June | Exam results declared |
| **Phase 2** | June-July | Online registration & choice filling |
| **Phase 3** | July-August | Counseling rounds (3-4 rounds) |
| **Phase 4** | August-September | Document verification & admission |
| **Phase 5** | September | Classes commence |

## Required Documents

| Document Type | Original | Photocopy | Notes |
|---------------|----------|-----------|-------|
| **10th Marksheet** | тЬЕ | тЬЕ | For age proof |
| **12th Marksheet** | тЬЕ | тЬЕ | PCM marks important |
| **Entrance Scorecard** | тЬЕ | тЬЕ | MHT-CET/JEE Main |
| **Caste Certificate** | тЬЕ | тЬЕ | If applicable |
| **Income Certificate** | тЬЕ | тЬЕ | For scholarships |

> Which specific college's admission process would you like detailed information about?`;
  }

  // Top colleges query
  else if (
    lowerMessage.includes("top") &&
    (lowerMessage.includes("college") || lowerMessage.includes("best"))
  ) {
    return `# ЁЯПЖ Top Engineering Colleges in Pune

## College Comparison Table

| Rank | College | Type | Est. | NIRF Rank | Avg Package | Fees/Year |
|------|---------|------|------|-----------|-------------|-----------|
| 1 | **COEP** | Govt | 1854 | 50-60 | тВ╣8-12 LPA | тВ╣50K-1L |
| 2 | **PICT** | Private | 1983 | 80-100 | тВ╣8-15 LPA | тВ╣2-3L |
| 3 | **VIT Pune** | Private | 1983 | 100-150 | тВ╣6-10 LPA | тВ╣2.5-3.5L |
| 4 | **MIT Pune** | Private | 1983 | 150-200 | тВ╣5-9 LPA | тВ╣3-4L |
| 5 | **SIT** | Private | 2008 | 200+ | тВ╣6-12 LPA | тВ╣4-6L |

## Key Strengths by College

| College | Best For | Top Recruiters | Special Features |
|---------|----------|----------------|------------------|
| **COEP** | All Engineering | TCS, Infosys, L&T | Oldest, Government, Research |
| **PICT** | CS/IT | Microsoft, Google, Amazon | IT Focus, Industry Connect |
| **VIT** | Mechanical, Civil | Bajaj, Tata, Mahindra | Industry Partnerships |
| **MIT** | Practical Learning | Wipro, Cognizant, Accenture | MIT Group Network |
| **SIT** | International Exposure | IBM, Deloitte, SAP | Global Programs |

## Selection Criteria Guide

| Priority | Best Choice | Why? |
|----------|-------------|------|
| **Low Fees** | COEP | Government college |
| **High Packages** | PICT | Top IT placements |
| **Research** | COEP | Oldest, best faculty |
| **Industry Connect** | VIT/MIT | Strong partnerships |
| **International** | SIT | Global exposure |

> What criteria matter most to you - fees, placements, specific branch, or reputation?`;
  } else {
    return responses.offline;
  }
}

// Store conversation history
let conversationHistory = [];

// Initialize language on page load
document.addEventListener("DOMContentLoaded", function () {
  // Set default language to English and update interface
  const languageSelect = document.getElementById("languageSelect");
  if (languageSelect) {
    languageSelect.value = "en";
    updateSuggestionCards("en");
    updateWelcomePageText("en");
  }
});

function toggleMenu() {
  var links = document.querySelector(".features");
  links.classList.toggle("active");
}

document
  .getElementById("voiceBtn")
  .addEventListener("click", startVoiceRecognition);
// Voice recognition setup
function startVoiceRecognition() {
  const recognition = new window.webkitSpeechRecognition();

  // Set language based on current selection
  const languageSelect = document.getElementById("languageSelect");
  const selectedLanguage = languageSelect ? languageSelect.value : "en";

  const languageCodes = {
    en: "en-US",
    hi: "hi-IN",
    mr: "mr-IN",
  };

  recognition.lang = languageCodes[selectedLanguage] || "en-US";
  console.log(`ЁЯОд Voice recognition started in: ${recognition.lang}`);

  recognition.onstart = () => console.log("Voice recognition started...");
  recognition.onresult = (event) => {
    const transcript = event.results[0][0].transcript;
    document.getElementById("userInput").value = transcript;
    sendMessage();
  };
  recognition.onerror = (event) => {
    console.error("Voice recognition error:", event.error);
  };
  recognition.start();
}

// Get all the nav links
const navLinks = document.querySelectorAll(".nav-link");

// Function to remove 'active' class from all links and add to the clicked one
navLinks.forEach((link) => {
  link.addEventListener("click", function () {
    // Remove active class from all links
    navLinks.forEach((link) => link.classList.remove("active"));

    // Add active class to the clicked link
    this.classList.add("active");
  });
});

// model code
document.addEventListener("DOMContentLoaded", () => {
  // Get the modal
  const modal = document.getElementById("myModal1");

  // Get the button that opens the modal
  const btn = document.getElementById("openModalButton1");

  // Get the <span> element that closes the modal
  const span = document.getElementsByClassName("close1")[0];

  // When the user clicks the button, open the modal
  btn.onclick = () => {
    modal.style.display = "block";
  };

  // When the user clicks on <span> (x), close the modal
  span.onclick = () => {
    modal.style.display = "none";
  };

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = (event) => {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
});

// Sidebar Toggle
function toggleSidebar() {
  const sidebar = document.getElementById("sidebar");
  const backdrop = document.getElementById("sidebar-backdrop");

  sidebar.classList.toggle("sidebar-visible");

  // Handle mobile backdrop
  if (window.innerWidth <= 768) {
    if (sidebar.classList.contains("sidebar-visible")) {
      backdrop.classList.add("active");
      document.body.style.overflow = "hidden"; // Prevent background scrolling
    } else {
      backdrop.classList.remove("active");
      document.body.style.overflow = "auto";
    }
  }
}
// Function to track messages in the sidebar
function trackMessage(messageText, sender, timePeriod) {
  let sectionId;

  switch (timePeriod) {
    case "today":
      sectionId = "today-messages";
      break;
    case "yesterday":
      sectionId = "yesterday-messages";
      break;
    case "week":
      sectionId = "week-messages";
      break;
    case "month":
      sectionId = "month-messages";
      break;
    default:
      sectionId = "today-messages";
  }

  const messageList = document.getElementById(sectionId);
  const messageElement = document.createElement("p");
  messageElement.innerText = sender === "user" ? `User: ${messageText}` : ``;
  messageList.appendChild(messageElement);
}

// Enhanced sendMessage function with LLM integration
async function sendMessage() {
  const userInput = document.getElementById("userInput");
  const messageText = userInput.value.trim();

  if (messageText) {
    document.getElementById("welcome-page").style.display = "none";
    document.getElementById("chatBox").style.display = "flex";

    // Add user message to chat
    addMessage(messageText, "user-message");
    trackMessage(messageText, "user", "today");

    // Add user message to conversation history
    conversationHistory.push({ role: "user", content: messageText });

    // Clear the input field
    userInput.value = "";

    // Show pinwheel loader for bot
    showTypingIndicator();

    try {
      // Get response from LLM
      const botResponse = await callGroqAPI(messageText, conversationHistory);

      // Remove pinwheel loader
      removeTypingIndicator();

      // Add bot response to chat
      addMessage(botResponse, "bot-message");
      trackMessage(botResponse, "bot", "today");

      // Add bot response to conversation history
      conversationHistory.push({ role: "assistant", content: botResponse });

      // Keep conversation history manageable (last 10 exchanges)
      if (conversationHistory.length > 20) {
        conversationHistory = conversationHistory.slice(-20);
      }
    } catch (error) {
      console.error("Error getting bot response:", error);
      removeTypingIndicator();

      const fallbackResponse = getFallbackResponse(messageText);
      addMessage(fallbackResponse, "bot-message");
      trackMessage(fallbackResponse, "bot", "today");
    }
  }
}

// Function to show pinwheel loader
function showTypingIndicator() {
  const chatBox = document.getElementById("chatBox");

  const loaderContainer = document.createElement("div");
  loaderContainer.classList.add("message", "bot-message", "loader-container");
  loaderContainer.innerHTML = `
    <div class="bot-message">
      <img src="final-chatbot-logo.png" class="bot-icon" />
      <div class="loader-content">
        <l-pinwheel size="35" stroke="3.5" speed="0.9" color="black"></l-pinwheel>
      </div>
    </div>
  `;

  loaderContainer.setAttribute("id", "typing-indicator"); // Keep same ID for removal

  chatBox.appendChild(loaderContainer);

  // Scroll to the bottom of the chatbox
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Function to remove pinwheel loader
function removeTypingIndicator() {
  const typingIndicator = document.getElementById("typing-indicator");
  if (typingIndicator) {
    typingIndicator.remove();
  }
}

// Function to add a message to the chatbox with markdown support
function addMessage(text, className) {
  const chatBox = document.getElementById("chatBox");

  const messageElement = document.createElement("div");
  messageElement.classList.add("message", className);

  if (className === "bot-message") {
    // Create a container for the bot message with icon
    const messageContainer = document.createElement("div");
    messageContainer.classList.add("bot-message");

    // Create the bot icon element
    const botIcon = document.createElement("img");
    botIcon.src = "final-chatbot-logo.png";
    botIcon.classList.add("bot-icon");

    // Create message content div
    const messageContent = document.createElement("div");
    messageContent.classList.add("bot-message-content");

    // Parse markdown and set HTML content for bot messages
    if (typeof marked !== "undefined") {
      messageContent.innerHTML = marked.parse(text);
    } else {
      // Fallback if marked is not loaded
      messageContent.innerHTML = formatTextAsHTML(text);
    }

    // Append icon and message content to the container
    messageContainer.appendChild(botIcon);
    messageContainer.appendChild(messageContent);

    // Append container to messageElement
    messageElement.appendChild(messageContainer);
  } else {
    // For user messages, keep as plain text
    messageElement.textContent = text;
  }

  chatBox.appendChild(messageElement);
  scrollToBottom();
  toggleScrollButton();

  // Scroll to the bottom of the chatbox
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Fallback function to format text as HTML if markdown library is not available
function formatTextAsHTML(text) {
  return text
    .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>") // Bold
    .replace(/\*(.*?)\*/g, "<em>$1</em>") // Italic
    .replace(/`(.*?)`/g, "<code>$1</code>") // Code
    .replace(/^# (.*$)/gim, "<h1>$1</h1>") // H1
    .replace(/^## (.*$)/gim, "<h2>$1</h2>") // H2
    .replace(/^### (.*$)/gim, "<h3>$1</h3>") // H3
    .replace(/^> (.*$)/gim, "<blockquote>$1</blockquote>") // Blockquote
    .replace(/\n/g, "<br>"); // Line breaks
}

function scrollToBottom() {
  const chatWindow = document.getElementById("chatBox");
  chatWindow.scrollTop = chatWindow.scrollHeight;
}
// Function to toggle the visibility of the scroll button
function toggleScrollButton() {
  const chatWindow = document.getElementById("chatBox");
  const scrollBtn = document.getElementById("scroll-btn");

  // Show the button if not already at the bottom of the chat
  if (
    chatWindow.scrollHeight - chatWindow.scrollTop >
    chatWindow.clientHeight + 20
  ) {
    scrollBtn.style.display = "flex"; // Show the button
  } else {
    scrollBtn.style.display = "none"; // Hide the button
  }
}
document
  .getElementById("chatBox")
  .addEventListener("scroll", toggleScrollButton);

// Function to handle pressing Enter key
function handleKeyPress(event) {
  if (event.key === "Enter") {
    sendMessage();
  }
}

const chatInput = document.getElementById("userInput");

chatInput.addEventListener("input", function () {
  this.style.height = "auto"; // Reset the height
  this.style.height = this.scrollHeight + "px"; // Set the height to match the scroll height
});

// promt suggestion
document.addEventListener("DOMContentLoaded", () => {
  // Ensure scroll button is hidden on page load
  const scrollBtn = document.getElementById("scroll-btn");
  if (scrollBtn) {
    scrollBtn.style.display = "none";
  }

  const welcomeMessages = {
    college:
      "Welcome! Got questions about our college? I'm here to assist you with admissions, courses, and more. How can I help today?",
    alumni:
      "Hello! Curious about our alumni network and their success stories? Let me guide you through our alumni achievements. What would you like to know?",
    degree:
      "Hi there! Looking for details on degree programs? Whether it's undergraduate or postgraduate, I've got you covered. What degree information can I help with?",
    fees: "Welcome! Need help understanding the fee structure for various courses? Ask me anything about fees, scholarships, and payment options.",
  };

  const userInput = document.getElementById("userInput");
  const sendButton = document.getElementById("send-btn");
  const suggestions = document.querySelectorAll(".suggestion");

  function insertPromptIntoInput(prompt) {
    userInput.value = prompt;
  }

  suggestions.forEach((suggestion) => {
    suggestion.addEventListener("click", async (event) => {
      event.preventDefault(); // Prevent default link behavior
      const prompt = suggestion.textContent;

      // Hide welcome page and show chat box
      document.getElementById("welcome-page").style.display = "none";
      document.getElementById("chatBox").style.display = "flex";

      // Add user message to chat
      addMessage(prompt, "user-message");
      trackMessage(prompt, "user", "today");

      // Add user message to conversation history
      conversationHistory.push({ role: "user", content: prompt });

      // Show pinwheel loader for bot
      showTypingIndicator();

      try {
        // Get response from LLM
        const botResponse = await callGroqAPI(prompt, conversationHistory);

        // Remove pinwheel loader
        removeTypingIndicator();

        // Add bot response to chat
        addMessage(botResponse, "bot-message");
        trackMessage(botResponse, "bot", "today");

        // Add bot response to conversation history
        conversationHistory.push({ role: "assistant", content: botResponse });

        // Keep conversation history manageable (last 10 exchanges)
        if (conversationHistory.length > 20) {
          conversationHistory = conversationHistory.slice(-20);
        }
      } catch (error) {
        console.error("Error getting bot response:", error);
        removeTypingIndicator();

        const fallbackResponse = getFallbackResponse(prompt);
        addMessage(fallbackResponse, "bot-message");
        trackMessage(fallbackResponse, "bot", "today");
      }
    });
  });

  sendButton.addEventListener("click", () => {
    const input = userInput.value.trim().toLowerCase();
    if (input) {
      if (input.includes("college")) {
        setWelcomeMessage("college");
      } else if (input.includes("alumni")) {
        setWelcomeMessage("alumni");
      } else if (input.includes("degree")) {
        setWelcomeMessage("degree");
      } else if (input.includes("fees")) {
        setWelcomeMessage("fees");
      } else {
        setWelcomeMessage("");
      }
      userInput.value = "";
    }
  });

  // Optionally set a default welcome message
  setWelcomeMessage("");
});

//new chat button code
document.addEventListener("DOMContentLoaded", () => {
  // Get the chatbox and buttons
  const chatbox = document.getElementById("welcome-page");
  const newChatButton = document.getElementById("newChatButton");
  const messagesContainer = document.getElementById("chatBox");

  // Show chatbox when "New Chat" is clicked
  newChatButton.addEventListener("click", () => {
    const scrollBtn = document.getElementById("scroll-btn");

    chatbox.style.display = "block"; // Show welcome page
    messagesContainer.innerHTML = ""; // Clear any previous messages
    messagesContainer.style.display = "none"; // Hide chat box
    conversationHistory = []; // Clear conversation history

    // Hide scroll button when creating new chat
    if (scrollBtn) {
      scrollBtn.style.display = "none";
    }
  });
});

function startChat() {
  // Simulate chatbot initiation, you can redirect to the chatbot page or open a modal
  window.location.href = "index.html";
  // For real chatbot integration, redirect to chatbot page:
  // window.location.href = "/chatbot-page.html";
}

// contact us college script
// College contact information (can be extended for more colleges)
const collegeData = {
  "College of Engineering Pune (COEP)": {
    name: "College of Engineering Pune (COEP)",
    address: "Wellesley Rd, Shivajinagar, Pune, Maharashtra 411005",
    phone: "+91 20 2550 7001",
    email: "info@coep.ac.in",
  },
  "Pune Institute of Computer Technology (PICT)": {
    name: "Pune Institute of Computer Technology (PICT)",
    address:
      "Survey No. 27, Near Trimurti Chowk, Dhankawadi, Pune, Maharashtra 411043",
    phone: "+91 20 2437 0077",
    email: "director@pict.edu",
  },
  "Vishwakarma Institute of Technology (VIT)": {
    name: "Vishwakarma Institute of Technology (VIT)",
    address: "666, Upper Indiranagar, Bibwewadi, Pune, Maharashtra 411037",
    phone: "+91 20 2428 2101",
    email: "principal@vit.edu",
  },
  "Maharashtra Institute of Technology (MIT)": {
    name: "Maharashtra Institute of Technology (MIT)",
    address: "Survey No. 124, Paud Rd, Kothrud, Pune, Maharashtra 411038",
    phone: "+91 20 2539 7500",
    email: "info@mitpune.edu.in",
  },
  // Add more colleges here
};

// Function to show college contact information
function showCollegeInfo(event) {
  event.preventDefault(); // Prevent the form from submitting

  const collegeName = document.getElementById("collegeName").value;
  const contactInfoDiv = document.getElementById("contactInfo");

  if (collegeData[collegeName]) {
    // Display the contact information for the entered college
    const college = collegeData[collegeName];
    contactInfoDiv.innerHTML = `
            <h3>Contact Information for ${college.name}</h3>
            <p><strong>Address:</strong> ${college.address}</p>
            <p><strong>Phone:</strong> ${college.phone}</p>
            <p><strong>Email:</strong> ${college.email}</p>
        `;
  } else {
    // If the college name is not found
    contactInfoDiv.innerHTML = `<p>Sorry, we couldn't find information for "${collegeName}". Please try another college name.</p>`;
  }

  // Clear suggestions when form is submitted
  document.getElementById("suggestions").style.display = "none";
}

// Function to suggest college names as user types
function suggestCollegeNames() {
  const input = document.getElementById("collegeName").value.toLowerCase();
  const suggestionsDiv = document.getElementById("suggestions");
  const colleges = Object.keys(collegeData);

  suggestionsDiv.innerHTML = ""; // Clear previous suggestions

  // Filter college names that match user input
  const filteredColleges = colleges.filter((college) =>
    college.toLowerCase().includes(input)
  );

  // Display suggestions if there is input and matching colleges
  if (input && filteredColleges.length > 0) {
    suggestionsDiv.style.display = "block";

    // Create suggestion items
    filteredColleges.forEach((college) => {
      const div = document.createElement("div");
      div.textContent = college;
      div.onclick = function () {
        document.getElementById("collegeName").value = college;
        suggestionsDiv.style.display = "none"; // Hide suggestions on click
      };
      suggestionsDiv.appendChild(div);
    });
  } else {
    suggestionsDiv.style.display = "none"; // Hide if no suggestions
  }
}

// setting script
const settingsButton = document.getElementById("settingsButton");
const settingsMenu = document.getElementById("settingsMenu");
const closeMenu = document.getElementById("closeMenu");

// Open the settings menu
settingsButton.addEventListener("click", () => {
  settingsMenu.style.display = "block";
});

// Close the settings menu
closeMenu.addEventListener("click", () => {
  settingsMenu.style.display = "none";
});

// Close the menu if clicked outside
window.addEventListener("click", (e) => {
  if (e.target === settingsMenu) {
    settingsMenu.style.display = "none";
  }
});

// Share button functionality
document.getElementById("shareButton").addEventListener("click", () => {
  shareChat();
});

// Theme change functionality (optional)
document.getElementById("themeSelect").addEventListener("change", (event) => {
  const theme = event.target.value;
  document.body.className = theme; // Change the theme by applying class
});

// Language change functionality
document
  .getElementById("languageSelect")
  .addEventListener("change", (event) => {
    const selectedLanguage = event.target.value;
    // console.log(`ЁЯМР Language changed to: ${selectedLanguage}`);

    // Clear conversation history when language changes
    conversationHistory = [];

    // Show a message about language change
    const languageNames = {
      en: "English",
      hi: "рд╣рд┐рдВрджреА (Hindi)",
      mr: "рдорд░рд╛рдареА (Marathi)",
    };

    const chatBox = document.getElementById("chatBox");
    if (chatBox && chatBox.style.display !== "none") {
      // Add a system message about language change
      const systemMessage = document.createElement("div");
      systemMessage.classList.add("message", "system-message");
      systemMessage.style.textAlign = "center";
      systemMessage.style.fontStyle = "italic";
      systemMessage.style.color = "#666";
      systemMessage.style.margin = "10px 0";

      const messages = {
        en: `Language changed to ${languageNames[selectedLanguage]}. Conversation history cleared.`,
        hi: `рднрд╛рд╖рд╛ ${languageNames[selectedLanguage]} рдореЗрдВ рдмрджрд▓ рджреА рдЧрдИред рдмрд╛рддрдЪреАрдд рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рд╕рд╛рдлрд╝ рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ред`,
        mr: `рднрд╛рд╖рд╛ ${languageNames[selectedLanguage]} рдордзреНрдпреЗ рдмрджрд▓рд▓реА. рд╕рдВрднрд╛рд╖рдг рдЗрддрд┐рд╣рд╛рд╕ рд╕рд╛рдл рдХреЗрд▓рд╛.`,
      };

      systemMessage.textContent = messages[selectedLanguage] || messages["en"];
      chatBox.appendChild(systemMessage);
      scrollToBottom();
    }

    // Update suggestion cards text based on language
    updateSuggestionCards(selectedLanguage);

    // Update welcome page text based on language
    updateWelcomePageText(selectedLanguage);
  });

// Function to update suggestion cards based on language
function updateSuggestionCards(language) {
  const suggestions = {
    en: [
      "Which are the top 5 engineering colleges in Pune based on placement, results, and facilities?",
      "What are the admission requirements for Computer Engineering at COEP Pune?",
      "What is the annual fees structure for B.Tech at PICT Pune?",
      "What is the average placement package at VIT Pune for Computer Science students?",
    ],
    hi: [
      "рдкреНрд▓реЗрд╕рдореЗрдВрдЯ, рдкрд░рд┐рдгрд╛рдо рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдкреБрдгреЗ рдХреЗ рдЯреЙрдк 5 рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЙрд▓реЗрдЬ рдХреМрди рд╕реЗ рд╣реИрдВ?",
      "COEP рдкреБрдгреЗ рдореЗрдВ рдХрдВрдкреНрдпреВрдЯрд░ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╡реЗрд╢ рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдВ рдХреНрдпрд╛ рд╣реИрдВ?",
      "PICT рдкреБрдгреЗ рдореЗрдВ B.Tech рдХреА рд╡рд╛рд░реНрд╖рд┐рдХ рдлреАрд╕ рд╕рдВрд░рдЪрдирд╛ рдХреНрдпрд╛ рд╣реИ?",
      "VIT рдкреБрдгреЗ рдореЗрдВ рдХрдВрдкреНрдпреВрдЯрд░ рд╕рд╛рдЗрдВрд╕ рдЫрд╛рддреНрд░реЛрдВ рдХреЗ рд▓рд┐рдП рдФрд╕рдд рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдкреИрдХреЗрдЬ рдХреНрдпрд╛ рд╣реИ?",
    ],
    mr: [
      "рдкреНрд▓реЗрд╕рдореЗрдВрдЯ, рдирд┐рдХрд╛рд▓ рдЖрдгрд┐ рд╕реБрд╡рд┐рдзрд╛рдВрдЪреНрдпрд╛ рдЖрдзрд╛рд░реЗ рдкреБрдгреНрдпрд╛рддреАрд▓ рдЯреЙрдк 5 рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдпреЗ рдХреЛрдгрддреА рдЖрд╣реЗрдд?",
      "COEP рдкреБрдгреЗ рдордзреНрдпреЗ рдХреЙрдореНрдкреНрдпреБрдЯрд░ рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреАрд╕рд╛рдареА рдкреНрд░рд╡реЗрд╢ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХрд╛рдп рдЖрд╣реЗрдд?",
      "PICT рдкреБрдгреЗ рдордзреНрдпреЗ B.Tech рдЪреА рд╡рд╛рд░реНрд╖рд┐рдХ рдлреА рд░рдЪрдирд╛ рдХрд╛рдп рдЖрд╣реЗ?",
      "VIT рдкреБрдгреЗ рдордзреНрдпреЗ рдХреЙрдореНрдкреНрдпреБрдЯрд░ рд╕рд╛рдпрдиреНрд╕ рд╡рд┐рджреНрдпрд╛рд░реНрдереНрдпрд╛рдВрд╕рд╛рдареА рд╕рд░рд╛рд╕рд░реА рдкреНрд▓реЗрд╕рдореЗрдВрдЯ рдкреЕрдХреЗрдЬ рдХрд╛рдп рдЖрд╣реЗ?",
    ],
  };

  const suggestionElements = document.querySelectorAll(".suggestion");
  const currentSuggestions = suggestions[language] || suggestions.en;

  suggestionElements.forEach((element, index) => {
    if (currentSuggestions[index]) {
      element.textContent = currentSuggestions[index];
    }
  });
}

// Function to update welcome page text based on language
function updateWelcomePageText(language) {
  const welcomeTexts = {
    en: {
      title: '"Your Gateway to Pune\'s Best Engineering Institutions."',
      description:
        "Get quick and latest info about the top engineering institutions in Pune. Powered by AI for intelligent, personalized responses. Let's dive in to find your perfect college match.",
    },
    hi: {
      title: '"рдкреБрдгреЗ рдХреЗ рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рд╕рдВрд╕реНрдерд╛рдиреЛрдВ рдХрд╛ рдкреНрд░рд╡реЗрд╢ рджреНрд╡рд╛рд░ред"',
      description:
        "рдкреБрдгреЗ рдХреЗ рд╢реАрд░реНрд╖ рдЗрдВрдЬреАрдирд┐рдпрд░рд┐рдВрдЧ рд╕рдВрд╕реНрдерд╛рдиреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рддреНрд╡рд░рд┐рдд рдФрд░ рдирд╡реАрдирддрдо рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред рдмреБрджреНрдзрд┐рдорд╛рди, рд╡реНрдпрдХреНрддрд┐рдЧрдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рддред рдЖрдЗрдП рдЖрдкрдХреЗ рд▓рд┐рдП рд╕рд╣реА рдХреЙрд▓реЗрдЬ рдЦреЛрдЬрдиреЗ рдореЗрдВ рдЧреЛрддрд╛ рд▓рдЧрд╛рдПрдВред",
    },
    mr: {
      title: '"рдкреБрдгреНрдпрд╛рддреАрд▓ рд╕рд░реНрд╡реЛрддреНрддрдо рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рд╕рдВрд╕реНрдерд╛рдВрдЪреЗ рдкреНрд░рд╡реЗрд╢рджреНрд╡рд╛рд░ред"',
      description:
        "рдкреБрдгреНрдпрд╛рддреАрд▓ рдЕрдЧреНрд░рдЧрдгреНрдп рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рд╕рдВрд╕реНрдерд╛рдВрдмрджреНрджрд▓ рддреНрд╡рд░рд┐рдд рдЖрдгрд┐ рдирд╡реАрдирддрдо рдорд╛рд╣рд┐рддреА рдорд┐рд│рд╡рд╛ред рдмреБрджреНрдзрд┐рдорд╛рди, рд╡реИрдпрдХреНрддрд┐рдХ рдкреНрд░рддрд┐рд╕рд╛рджрд╛рдВрд╕рд╛рдареА AI рджреНрд╡рд╛рд░реЗ рдЪрд╛рд▓рд╡рд▓реЗ рдЬрд╛рддреЗ. рддреБрдордЪреНрдпрд╛рд╕рд╛рдареА рдпреЛрдЧреНрдп рдорд╣рд╛рд╡рд┐рджреНрдпрд╛рд▓рдп рд╢реЛрдзрдгреНрдпрд╛рд╕рд╛рдареА рд╕реБрд░реБрд╡рд╛рдд рдХрд░реВрдпрд╛.",
    },
  };

  const currentTexts = welcomeTexts[language] || welcomeTexts.en;

  // Update welcome page title
  const titleElement = document.querySelector("#welcome-page h3");
  if (titleElement) {
    titleElement.textContent = currentTexts.title;
  }

  // Update welcome page description
  const descriptionElement = document.querySelector("#welcome-page p");
  if (descriptionElement) {
    descriptionElement.textContent = currentTexts.description;
  }
}

// Sidebar functionality for clear history buttons
document.addEventListener("DOMContentLoaded", function () {
  // Clear history button in sidebar
  const clearChatSidebarBtn = document.getElementById("clearChatSidebarBtn");
  if (clearChatSidebarBtn) {
    clearChatSidebarBtn.addEventListener("click", function () {
      clearChatHistory();
    });
  }

  // Clear history button in settings
  const clearHistoryBtn = document.getElementById("clearHistoryBtn");
  if (clearHistoryBtn) {
    clearHistoryBtn.addEventListener("click", function () {
      clearChatHistory();
    });
  }

  // New chat button in sidebar
  const newChatSidebarBtn = document.getElementById("newChatSidebarBtn");
  if (newChatSidebarBtn) {
    newChatSidebarBtn.addEventListener("click", function () {
      startNewChat();
    });
  }

  // Expand/collapse functionality for history section
  const historyExpandBtn = document.getElementById("historyExpandBtn");
  const historyContent = document.getElementById("historyContent");
  if (historyExpandBtn && historyContent) {
    historyExpandBtn.addEventListener("click", function () {
      const isExpanded = historyContent.style.display !== "none";
      if (isExpanded) {
        historyContent.style.display = "none";
        historyExpandBtn.innerHTML = '<i class="ri-arrow-right-s-line"></i>';
      } else {
        historyContent.style.display = "block";
        historyExpandBtn.innerHTML = '<i class="ri-arrow-down-s-line"></i>';
      }
    });
  }

  // Expand/collapse functionality for saved section
  const savedExpandBtn = document.getElementById("savedExpandBtn");
  const savedContent = document.getElementById("savedContent");
  if (savedExpandBtn && savedContent) {
    savedExpandBtn.addEventListener("click", function () {
      const isExpanded = savedContent.style.display !== "none";
      if (isExpanded) {
        savedContent.style.display = "none";
        savedExpandBtn.innerHTML = '<i class="ri-arrow-right-s-line"></i>';
      } else {
        savedContent.style.display = "block";
        savedExpandBtn.innerHTML = '<i class="ri-arrow-down-s-line"></i>';
      }
    });
  }
});

// Function to clear chat history
function clearChatHistory() {
  const chatBox = document.getElementById("chatBox");
  const welcomePage = document.getElementById("welcome-page");
  const scrollBtn = document.getElementById("scroll-btn");

  if (chatBox) {
    chatBox.innerHTML = "";
    chatBox.style.display = "none";
  }

  if (welcomePage) {
    welcomePage.style.display = "block";
  }

  // Hide scroll button when clearing chat
  if (scrollBtn) {
    scrollBtn.style.display = "none";
  }

  // Clear conversation history
  conversationHistory = [];

  // Clear message lists in sidebar
  const todayMessages = document.getElementById("today-messages");
  const yesterdayMessages = document.getElementById("yesterday-messages");
  const weekMessages = document.getElementById("week-messages");

  if (todayMessages) todayMessages.innerHTML = "";
  if (yesterdayMessages) yesterdayMessages.innerHTML = "";
  if (weekMessages) weekMessages.innerHTML = "";

  // Show confirmation message
  alert("Chat history cleared successfully!");
}

// Function to start a new chat
function startNewChat() {
  clearChatHistory();
}

// Handle window resize for sidebar backdrop
window.addEventListener("resize", function () {
  const sidebar = document.getElementById("sidebar");
  const backdrop = document.getElementById("sidebar-backdrop");

  if (window.innerWidth > 768) {
    // Desktop view - remove backdrop and restore scrolling
    backdrop.classList.remove("active");
    document.body.style.overflow = "auto";
  } else {
    // Mobile view - maintain backdrop state based on sidebar visibility
    if (sidebar.classList.contains("sidebar-visible")) {
      backdrop.classList.add("active");
      document.body.style.overflow = "hidden";
    }
  }
});

// Additional action button functionality
document.addEventListener("DOMContentLoaded", function () {
  // Export Chat Button
  const exportChatBtn = document.getElementById("exportChatBtn");
  if (exportChatBtn) {
    exportChatBtn.addEventListener("click", function () {
      exportChatHistory();
    });
  }

  // Send Feedback Button
  const feedbackBtn = document.getElementById("feedbackBtn");
  if (feedbackBtn) {
    feedbackBtn.addEventListener("click", function () {
      openFeedbackForm();
    });
  }
});

// Function to share chatbot
function shareChat() {
  if (navigator.share) {
    navigator
      .share({
        title: "VIDHUR AI - College Assistant",
        text: "Check out this amazing AI chatbot for Pune engineering colleges!",
        url: window.location.href,
      })
      .then(() => {
        console.log("тЬЕ Shared successfully");
      })
      .catch((error) => {
        console.log("тЭМ Error sharing:", error);
        fallbackShare();
      });
  } else {
    fallbackShare();
  }
}

// Fallback share function
function fallbackShare() {
  const shareText = `Check out VIDHUR AI - Your gateway to Pune's best engineering institutions! ${window.location.href}`;

  if (navigator.clipboard) {
    navigator.clipboard
      .writeText(shareText)
      .then(() => {
        alert("ЁЯФЧ Share link copied to clipboard!\n\n" + shareText);
      })
      .catch(() => {
        promptManualCopy(shareText);
      });
  } else {
    promptManualCopy(shareText);
  }
}

// Manual copy prompt
function promptManualCopy(text) {
  const textarea = document.createElement("textarea");
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();

  try {
    document.execCommand("copy");
    alert("ЁЯФЧ Share link copied to clipboard!\n\n" + text);
  } catch (err) {
    alert("ЁЯУЛ Please copy this link manually:\n\n" + text);
  }

  document.body.removeChild(textarea);
}

// Function to export chat history
function exportChatHistory() {
  const chatBox = document.getElementById("chatBox");
  if (!chatBox || chatBox.children.length === 0) {
    alert("ЁЯУЭ No chat history to export. Start a conversation first!");
    return;
  }

  let exportText = "VIDHUR AI - College Assistant Chat Export\n";
  exportText += "=".repeat(50) + "\n";
  exportText += `Export Date: ${new Date().toLocaleString()}\n\n`;

  const messages = chatBox.children;
  for (let i = 0; i < messages.length; i++) {
    const message = messages[i];
    if (message.classList.contains("user-message")) {
      exportText += `ЁЯСд USER: ${message.textContent.trim()}\n\n`;
    } else if (message.classList.contains("bot-message")) {
      const content = message.querySelector(".bot-message-content");
      if (content) {
        exportText += `ЁЯдЦ VIDHUR AI: ${content.textContent.trim()}\n\n`;
      }
    } else if (message.classList.contains("system-message")) {
      exportText += `ЁЯФФ SYSTEM: ${message.textContent.trim()}\n\n`;
    }
  }

  exportText += "=".repeat(50) + "\n";
  exportText += "Generated by VIDHUR AI - DataDynamos Team";

  // Create and download file
  const blob = new Blob([exportText], { type: "text/plain" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `VIDHUR_AI_Chat_${new Date().toISOString().split("T")[0]}.txt`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  alert("ЁЯУБ Chat history exported successfully!");
}

// Function to open feedback form
function openFeedbackForm() {
  const feedback = prompt(`ЁЯУЭ We'd love to hear your feedback about VIDHUR AI!

Please share your thoughts about:
тАв How helpful were the responses?
тАв What features would you like to see?
тАв Any suggestions for improvement?

Your feedback:`);

  if (feedback && feedback.trim()) {
    // Simulate sending feedback
    setTimeout(() => {
      alert(`тЬЕ Thank you for your feedback!

Your message: "${feedback.trim()}"

We appreciate your input and will use it to improve VIDHUR AI. Our team will review your feedback and consider it for future updates.

- DataDynamos Team`);
    }, 500);
  } else if (feedback !== null) {
    alert("ЁЯУЭ Please provide some feedback to help us improve!");
  }
}
